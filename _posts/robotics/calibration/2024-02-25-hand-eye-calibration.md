---
title: Hand Eye Calibration 
author: vector
date: 2024-02-25 12:10:46 +0900
categories: roboticscalibration
pin: true
math: true
mermaid: true
---
Finding hand-eye calibration equations using sympy


```python
import numpy as np
import sympy as sm
import scipy.spatial.transform as transform
np.set_printoptions(suppress=True)
sm.init_printing()

from IPython.display import Math, display
```

# Creating symbols


```python
# AX = ZB
symbolLetterTemplates = ['a', 'x', 'z', 'b']
allSymbols = []

# Creating 12 symbols for each matrix
for template in symbolLetterTemplates:
    allSymbols.append([sm.Symbol(template + str(i)) for i in range(3 * 4)])

display('ALL SYMBOLS:')
for symbols in allSymbols:
    display(symbols)

# Creating matrices from symbols
symMatA = sm.Matrix([allSymbols[0][:4], allSymbols[0][4:8], allSymbols[0][8:12], [0, 0, 0, 1]])
symMatX = sm.Matrix([allSymbols[1][:4], allSymbols[1][4:8], allSymbols[1][8:12], [0, 0, 0, 1]])
symMatZ = sm.Matrix([allSymbols[2][:4], allSymbols[2][4:8], allSymbols[2][8:12], [0, 0, 0, 1]])
symMatB = sm.Matrix([allSymbols[3][:4], allSymbols[3][4:8], allSymbols[3][8:12], [0, 0, 0, 1]])

display('MATRICES:', 'A:', symMatA, 'X:', symMatX, 'Z:', symMatZ, 'B:', symMatB)
matrixEquation = symMatA * symMatX - symMatZ * symMatB
display('EQUATION:', matrixEquation)
```


    'ALL SYMBOLS:'



$\displaystyle \left[ a_{0}, \  a_{1}, \  a_{2}, \  a_{3}, \  a_{4}, \  a_{5}, \  a_{6}, \  a_{7}, \  a_{8}, \  a_{9}, \  a_{10}, \  a_{11}\right]$



$\displaystyle \left[ x_{0}, \  x_{1}, \  x_{2}, \  x_{3}, \  x_{4}, \  x_{5}, \  x_{6}, \  x_{7}, \  x_{8}, \  x_{9}, \  x_{10}, \  x_{11}\right]$



$\displaystyle \left[ z_{0}, \  z_{1}, \  z_{2}, \  z_{3}, \  z_{4}, \  z_{5}, \  z_{6}, \  z_{7}, \  z_{8}, \  z_{9}, \  z_{10}, \  z_{11}\right]$



$\displaystyle \left[ b_{0}, \  b_{1}, \  b_{2}, \  b_{3}, \  b_{4}, \  b_{5}, \  b_{6}, \  b_{7}, \  b_{8}, \  b_{9}, \  b_{10}, \  b_{11}\right]$



    'MATRICES:'



    'A:'



$$\displaystyle \left[\begin{matrix}a_{0} & a_{1} & a_{2} & a_{3}\\a_{4} & a_{5} & a_{6} & a_{7}\\a_{8} & a_{9} & a_{10} & a_{11}\\0 & 0 & 0 & 1\end{matrix}\right]$$



    'X:'



$$\displaystyle \left[\begin{matrix}x_{0} & x_{1} & x_{2} & x_{3}\\x_{4} & x_{5} & x_{6} & x_{7}\\x_{8} & x_{9} & x_{10} & x_{11}\\0 & 0 & 0 & 1\end{matrix}\right]$$



    'Z:'



$$\displaystyle \left[\begin{matrix}z_{0} & z_{1} & z_{2} & z_{3}\\z_{4} & z_{5} & z_{6} & z_{7}\\z_{8} & z_{9} & z_{10} & z_{11}\\0 & 0 & 0 & 1\end{matrix}\right]$$



    'B:'



$$\displaystyle \left[\begin{matrix}b_{0} & b_{1} & b_{2} & b_{3}\\b_{4} & b_{5} & b_{6} & b_{7}\\b_{8} & b_{9} & b_{10} & b_{11}\\0 & 0 & 0 & 1\end{matrix}\right]$$



    'EQUATION:'



$$\displaystyle \left[\begin{matrix}a_{0} x_{0} + a_{1} x_{4} + a_{2} x_{8} - b_{0} z_{0} - b_{4} z_{1} - b_{8} z_{2} & a_{0} x_{1} + a_{1} x_{5} + a_{2} x_{9} - b_{1} z_{0} - b_{5} z_{1} - b_{9} z_{2} & a_{0} x_{2} + a_{1} x_{6} + a_{2} x_{10} - b_{10} z_{2} - b_{2} z_{0} - b_{6} z_{1} & a_{0} x_{3} + a_{1} x_{7} + a_{2} x_{11} + a_{3} - b_{11} z_{2} - b_{3} z_{0} - b_{7} z_{1} - z_{3}\\a_{4} x_{0} + a_{5} x_{4} + a_{6} x_{8} - b_{0} z_{4} - b_{4} z_{5} - b_{8} z_{6} & a_{4} x_{1} + a_{5} x_{5} + a_{6} x_{9} - b_{1} z_{4} - b_{5} z_{5} - b_{9} z_{6} & a_{4} x_{2} + a_{5} x_{6} + a_{6} x_{10} - b_{10} z_{6} - b_{2} z_{4} - b_{6} z_{5} & a_{4} x_{3} + a_{5} x_{7} + a_{6} x_{11} + a_{7} - b_{11} z_{6} - b_{3} z_{4} - b_{7} z_{5} - z_{7}\\a_{10} x_{8} + a_{8} x_{0} + a_{9} x_{4} - b_{0} z_{8} - b_{4} z_{9} - b_{8} z_{10} & a_{10} x_{9} + a_{8} x_{1} + a_{9} x_{5} - b_{1} z_{8} - b_{5} z_{9} - b_{9} z_{10} & a_{10} x_{10} + a_{8} x_{2} + a_{9} x_{6} - b_{10} z_{10} - b_{2} z_{8} - b_{6} z_{9} & a_{10} x_{11} + a_{11} + a_{8} x_{3} + a_{9} x_{7} - b_{11} z_{10} - b_{3} z_{8} - b_{7} z_{9} - z_{11}\\0 & 0 & 0 & 0\end{matrix}\right]$$


# Creating Linear Least Square Matrix equation (Ax = b)


```python
# Creating linear matrix equations
leastsqMatA, leastsqMatb = sm.linear_eq_to_matrix(
    matrixEquation,
    [x for x in allSymbols[1]] + [z for z in allSymbols[2]]     # <<< Unknowns
)

display('Linear Equation:', 'A:', leastsqMatA, 'b:', leastsqMatb)
```


    'Linear Equation:'



    'A:'



$$\displaystyle \left[\begin{array}{cccccccccccccccccccccccc}a_{0} & 0 & 0 & 0 & a_{1} & 0 & 0 & 0 & a_{2} & 0 & 0 & 0 & - b_{0} & - b_{4} & - b_{8} & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0\\0 & a_{0} & 0 & 0 & 0 & a_{1} & 0 & 0 & 0 & a_{2} & 0 & 0 & - b_{1} & - b_{5} & - b_{9} & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0\\0 & 0 & a_{0} & 0 & 0 & 0 & a_{1} & 0 & 0 & 0 & a_{2} & 0 & - b_{2} & - b_{6} & - b_{10} & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0\\0 & 0 & 0 & a_{0} & 0 & 0 & 0 & a_{1} & 0 & 0 & 0 & a_{2} & - b_{3} & - b_{7} & - b_{11} & -1 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0\\a_{4} & 0 & 0 & 0 & a_{5} & 0 & 0 & 0 & a_{6} & 0 & 0 & 0 & 0 & 0 & 0 & 0 & - b_{0} & - b_{4} & - b_{8} & 0 & 0 & 0 & 0 & 0\\0 & a_{4} & 0 & 0 & 0 & a_{5} & 0 & 0 & 0 & a_{6} & 0 & 0 & 0 & 0 & 0 & 0 & - b_{1} & - b_{5} & - b_{9} & 0 & 0 & 0 & 0 & 0\\0 & 0 & a_{4} & 0 & 0 & 0 & a_{5} & 0 & 0 & 0 & a_{6} & 0 & 0 & 0 & 0 & 0 & - b_{2} & - b_{6} & - b_{10} & 0 & 0 & 0 & 0 & 0\\0 & 0 & 0 & a_{4} & 0 & 0 & 0 & a_{5} & 0 & 0 & 0 & a_{6} & 0 & 0 & 0 & 0 & - b_{3} & - b_{7} & - b_{11} & -1 & 0 & 0 & 0 & 0\\a_{8} & 0 & 0 & 0 & a_{9} & 0 & 0 & 0 & a_{10} & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & - b_{0} & - b_{4} & - b_{8} & 0\\0 & a_{8} & 0 & 0 & 0 & a_{9} & 0 & 0 & 0 & a_{10} & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & - b_{1} & - b_{5} & - b_{9} & 0\\0 & 0 & a_{8} & 0 & 0 & 0 & a_{9} & 0 & 0 & 0 & a_{10} & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & - b_{2} & - b_{6} & - b_{10} & 0\\0 & 0 & 0 & a_{8} & 0 & 0 & 0 & a_{9} & 0 & 0 & 0 & a_{10} & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & - b_{3} & - b_{7} & - b_{11} & -1\\0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0\\0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0\\0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0\\0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0\end{array}\right]$$



    'b:'



$$\displaystyle \left[\begin{matrix}0\\0\\0\\- a_{3}\\0\\0\\0\\- a_{7}\\0\\0\\0\\- a_{11}\\0\\0\\0\\0\end{matrix}\right]$$


# Removing redundant rows


```python
reducedLsqMatA = sm.Matrix(leastsqMatA[:-4, :])
reducedLsqMatb = sm.Matrix(leastsqMatb[:-4])
display('Minimal Linear Equation: ', 'A:', reducedLsqMatA, 'Rank A:', reducedLsqMatA.rank(), 'b:', reducedLsqMatA)
```


    'Minimal Linear Equation: '



    'A:'



$$\displaystyle \left[\begin{array}{cccccccccccccccccccccccc}a_{0} & 0 & 0 & 0 & a_{1} & 0 & 0 & 0 & a_{2} & 0 & 0 & 0 & - b_{0} & - b_{4} & - b_{8} & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0\\0 & a_{0} & 0 & 0 & 0 & a_{1} & 0 & 0 & 0 & a_{2} & 0 & 0 & - b_{1} & - b_{5} & - b_{9} & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0\\0 & 0 & a_{0} & 0 & 0 & 0 & a_{1} & 0 & 0 & 0 & a_{2} & 0 & - b_{2} & - b_{6} & - b_{10} & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0\\0 & 0 & 0 & a_{0} & 0 & 0 & 0 & a_{1} & 0 & 0 & 0 & a_{2} & - b_{3} & - b_{7} & - b_{11} & -1 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0\\a_{4} & 0 & 0 & 0 & a_{5} & 0 & 0 & 0 & a_{6} & 0 & 0 & 0 & 0 & 0 & 0 & 0 & - b_{0} & - b_{4} & - b_{8} & 0 & 0 & 0 & 0 & 0\\0 & a_{4} & 0 & 0 & 0 & a_{5} & 0 & 0 & 0 & a_{6} & 0 & 0 & 0 & 0 & 0 & 0 & - b_{1} & - b_{5} & - b_{9} & 0 & 0 & 0 & 0 & 0\\0 & 0 & a_{4} & 0 & 0 & 0 & a_{5} & 0 & 0 & 0 & a_{6} & 0 & 0 & 0 & 0 & 0 & - b_{2} & - b_{6} & - b_{10} & 0 & 0 & 0 & 0 & 0\\0 & 0 & 0 & a_{4} & 0 & 0 & 0 & a_{5} & 0 & 0 & 0 & a_{6} & 0 & 0 & 0 & 0 & - b_{3} & - b_{7} & - b_{11} & -1 & 0 & 0 & 0 & 0\\a_{8} & 0 & 0 & 0 & a_{9} & 0 & 0 & 0 & a_{10} & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & - b_{0} & - b_{4} & - b_{8} & 0\\0 & a_{8} & 0 & 0 & 0 & a_{9} & 0 & 0 & 0 & a_{10} & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & - b_{1} & - b_{5} & - b_{9} & 0\\0 & 0 & a_{8} & 0 & 0 & 0 & a_{9} & 0 & 0 & 0 & a_{10} & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & - b_{2} & - b_{6} & - b_{10} & 0\\0 & 0 & 0 & a_{8} & 0 & 0 & 0 & a_{9} & 0 & 0 & 0 & a_{10} & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & - b_{3} & - b_{7} & - b_{11} & -1\end{array}\right]$$



    'Rank A:'



$\displaystyle 12$



    'b:'



$$\displaystyle \left[\begin{array}{cccccccccccccccccccccccc}a_{0} & 0 & 0 & 0 & a_{1} & 0 & 0 & 0 & a_{2} & 0 & 0 & 0 & - b_{0} & - b_{4} & - b_{8} & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0\\0 & a_{0} & 0 & 0 & 0 & a_{1} & 0 & 0 & 0 & a_{2} & 0 & 0 & - b_{1} & - b_{5} & - b_{9} & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0\\0 & 0 & a_{0} & 0 & 0 & 0 & a_{1} & 0 & 0 & 0 & a_{2} & 0 & - b_{2} & - b_{6} & - b_{10} & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0\\0 & 0 & 0 & a_{0} & 0 & 0 & 0 & a_{1} & 0 & 0 & 0 & a_{2} & - b_{3} & - b_{7} & - b_{11} & -1 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0\\a_{4} & 0 & 0 & 0 & a_{5} & 0 & 0 & 0 & a_{6} & 0 & 0 & 0 & 0 & 0 & 0 & 0 & - b_{0} & - b_{4} & - b_{8} & 0 & 0 & 0 & 0 & 0\\0 & a_{4} & 0 & 0 & 0 & a_{5} & 0 & 0 & 0 & a_{6} & 0 & 0 & 0 & 0 & 0 & 0 & - b_{1} & - b_{5} & - b_{9} & 0 & 0 & 0 & 0 & 0\\0 & 0 & a_{4} & 0 & 0 & 0 & a_{5} & 0 & 0 & 0 & a_{6} & 0 & 0 & 0 & 0 & 0 & - b_{2} & - b_{6} & - b_{10} & 0 & 0 & 0 & 0 & 0\\0 & 0 & 0 & a_{4} & 0 & 0 & 0 & a_{5} & 0 & 0 & 0 & a_{6} & 0 & 0 & 0 & 0 & - b_{3} & - b_{7} & - b_{11} & -1 & 0 & 0 & 0 & 0\\a_{8} & 0 & 0 & 0 & a_{9} & 0 & 0 & 0 & a_{10} & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & - b_{0} & - b_{4} & - b_{8} & 0\\0 & a_{8} & 0 & 0 & 0 & a_{9} & 0 & 0 & 0 & a_{10} & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & - b_{1} & - b_{5} & - b_{9} & 0\\0 & 0 & a_{8} & 0 & 0 & 0 & a_{9} & 0 & 0 & 0 & a_{10} & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & - b_{2} & - b_{6} & - b_{10} & 0\\0 & 0 & 0 & a_{8} & 0 & 0 & 0 & a_{9} & 0 & 0 & 0 & a_{10} & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & - b_{3} & - b_{7} & - b_{11} & -1\end{array}\right]$$


# Reducing the linear least squares equation down to the basics


```python
symLHS = sm.kronecker_product(symMatA[:3, :3], sm.eye(4)).row_join(sm.kronecker_product(-sm.eye(3), symMatB.T))
symRHS = sm.kronecker_product(symMatA[:3, -1], -sm.Matrix([0, 0, 0, 1]))

display(symLHS)
display(symRHS)

```


$$\displaystyle \left[\begin{array}{cccccccccccccccccccccccc}a_{0} & 0 & 0 & 0 & a_{1} & 0 & 0 & 0 & a_{2} & 0 & 0 & 0 & - b_{0} & - b_{4} & - b_{8} & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0\\0 & a_{0} & 0 & 0 & 0 & a_{1} & 0 & 0 & 0 & a_{2} & 0 & 0 & - b_{1} & - b_{5} & - b_{9} & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0\\0 & 0 & a_{0} & 0 & 0 & 0 & a_{1} & 0 & 0 & 0 & a_{2} & 0 & - b_{2} & - b_{6} & - b_{10} & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0\\0 & 0 & 0 & a_{0} & 0 & 0 & 0 & a_{1} & 0 & 0 & 0 & a_{2} & - b_{3} & - b_{7} & - b_{11} & -1 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0\\a_{4} & 0 & 0 & 0 & a_{5} & 0 & 0 & 0 & a_{6} & 0 & 0 & 0 & 0 & 0 & 0 & 0 & - b_{0} & - b_{4} & - b_{8} & 0 & 0 & 0 & 0 & 0\\0 & a_{4} & 0 & 0 & 0 & a_{5} & 0 & 0 & 0 & a_{6} & 0 & 0 & 0 & 0 & 0 & 0 & - b_{1} & - b_{5} & - b_{9} & 0 & 0 & 0 & 0 & 0\\0 & 0 & a_{4} & 0 & 0 & 0 & a_{5} & 0 & 0 & 0 & a_{6} & 0 & 0 & 0 & 0 & 0 & - b_{2} & - b_{6} & - b_{10} & 0 & 0 & 0 & 0 & 0\\0 & 0 & 0 & a_{4} & 0 & 0 & 0 & a_{5} & 0 & 0 & 0 & a_{6} & 0 & 0 & 0 & 0 & - b_{3} & - b_{7} & - b_{11} & -1 & 0 & 0 & 0 & 0\\a_{8} & 0 & 0 & 0 & a_{9} & 0 & 0 & 0 & a_{10} & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & - b_{0} & - b_{4} & - b_{8} & 0\\0 & a_{8} & 0 & 0 & 0 & a_{9} & 0 & 0 & 0 & a_{10} & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & - b_{1} & - b_{5} & - b_{9} & 0\\0 & 0 & a_{8} & 0 & 0 & 0 & a_{9} & 0 & 0 & 0 & a_{10} & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & - b_{2} & - b_{6} & - b_{10} & 0\\0 & 0 & 0 & a_{8} & 0 & 0 & 0 & a_{9} & 0 & 0 & 0 & a_{10} & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & - b_{3} & - b_{7} & - b_{11} & -1\end{array}\right]$$



$$\displaystyle \left[\begin{matrix}0\\0\\0\\- a_{3}\\0\\0\\0\\- a_{7}\\0\\0\\0\\- a_{11}\end{matrix}\right]$$



```python
# Verify if the euqations match
reducedLsqMatA == symLHS
```




    True




```python
Ra = sm.MatrixSymbol('R_a', 3, 3)
ta = sm.MatrixSymbol('t_a', 3, 1)
B = sm.MatrixSymbol('B', 4, 4)
I3 = sm.MatrixSymbol('I_3', 3, 3)
I4 = sm.MatrixSymbol('I_4', 4, 4)
xVec = sm.MatrixSymbol('vec(X)_12,1', 12, 1)
zVec = sm.MatrixSymbol('vec(Z)_12,1', 12, 1)

cuteEquationLHS = sm.BlockMatrix([
    sm.kronecker_product(Ra, I4),
    sm.kronecker_product(-I3, B.T)
]) * sm.BlockMatrix([
    [xVec],
    [zVec]
])


cuteEquationRHS = sm.kronecker_product(ta, sm.Matrix([0, 0, 0, -1]))

cuteEquation = sm.Eq(cuteEquationLHS, cuteEquationRHS)

display(cuteEquation)
```


$$\displaystyle \left[\begin{matrix}R_{a} \otimes I_{4} & - I_{3} \otimes B^{T}\end{matrix}\right] \left[\begin{matrix}vec(X)_{12,1}\\vec(Z)_{12,1}\end{matrix}\right] = t_{a} \otimes \left[\begin{matrix}0\\0\\0\\-1\end{matrix}\right]$$



```python
# Creating dummy dataset
gtAs = []
gtBs = []
gtX = np.eye(4, dtype=float)
gtX[:3, -1] = [1, 2, 3]

gtZ = np.eye(4, dtype=float)
gtZ[:3, -1] = [3, 3, 10]
gtZ[:3, 2] *= -1   # z-Looking down
gtZ[:3, 1] *= -1   # Looking down

numsamples = 10

for i in range(numsamples):
    r = 2 * (np.random.rand(3) - 0.5) * 2 * np.pi
    r /= np.linalg.norm(r)
    t = 2 * (np.random.rand(3) - 0.5) * 5
    
    T = np.eye(4)
    T[:3, :3] = transform.Rotation.from_rotvec(r).as_matrix()
    T[:3, -1] = t
    
    gtAs.append(T.copy())
    
    attachedObjectInStatic = np.dot(np.dot(np.linalg.inv(gtZ), T.copy()), gtX)
    attachedObjectInStatic[:3, -1] += 2.0 * (np.random.rand(3) - 0.5) * 0.01
    gtBs.append(attachedObjectInStatic)
    
    print(T, attachedObjectInStatic)

```

    [[ 0.80840207  0.56794484  0.15467627 -2.36277745]
     [-0.28961819  0.61253822 -0.73547144 -1.07554431]
     [-0.51245233  0.54975958  0.65966432  2.50785386]
     [ 0.          0.          0.          1.        ]] [[ 0.80840207  0.56794484  0.15467627 -2.95589595]
     [ 0.28961819 -0.61253822  0.73547144  5.33975038]
     [ 0.51245233 -0.54975958 -0.65966432  4.93342701]
     [ 0.          0.          0.          1.        ]]
    [[ 0.61564296  0.29215065  0.73186867 -1.71382338]
     [ 0.04372455  0.91464256 -0.40189196  2.14211788]
     [-0.78681123  0.27942259  0.55031909  4.36360761]
     [ 0.          0.          0.          1.        ]] [[ 0.61564296  0.29215065  0.73186867 -1.32286969]
     [-0.04372455 -0.91464256  0.40189196  0.19564461]
     [ 0.78681123 -0.27942259 -0.55031909  4.21603153]
     [ 0.          0.          0.          1.        ]]
    [[ 0.54095521  0.38755168 -0.74643898 -3.3567512 ]
     [-0.35650036  0.90949242  0.21384813  2.65596225]
     [ 0.7617578   0.15042351  0.63015698  2.53334434]
     [ 0.          0.          0.          1.        ]] [[ 0.54095521  0.38755168 -0.74643898 -7.28054601]
     [ 0.35650036 -0.90949242 -0.21384813 -1.75700827]
     [-0.7617578  -0.15042351 -0.63015698  4.51383441]
     [ 0.          0.          0.          1.        ]]
    [[ 0.67867283  0.71920037 -0.14884225  4.609944  ]
     [-0.68250326  0.54273541 -0.4895177   2.27660907]
     [-0.27127935  0.43380768  0.85919637  3.06036603]
     [ 0.          0.          0.          1.        ]] [[ 0.67867283  0.71920037 -0.14884225  3.28721553]
     [ 0.68250326 -0.54273541  0.4895177   1.78671086]
     [ 0.27127935 -0.43380768 -0.85919637  3.75919026]
     [ 0.          0.          0.          1.        ]]
    [[ 0.73404577  0.67843428 -0.03006216  0.73385613]
     [-0.50789137  0.57783246  0.63887089  0.33392329]
     [ 0.4508028  -0.45369216  0.76872639 -2.17236756]
     [ 0.          0.          0.          1.        ]] [[ 0.73404577  0.67843428 -0.03006216 -0.26532191]
     [ 0.50789137 -0.57783246 -0.63887089  0.09316117]
     [-0.4508028   0.45369216 -0.76872639 10.32295209]
     [ 0.          0.          0.          1.        ]]
    [[ 0.77338203 -0.63387433  0.00914147  3.30358182]
     [ 0.46107388  0.57232997  0.67812188  3.84372053]
     [-0.43507599 -0.52023238  0.73489261  0.94900061]
     [ 0.          0.          0.          1.        ]] [[ 0.77338203 -0.63387433  0.00914147 -0.16869324]
     [-0.46107388 -0.57232997 -0.67812188 -4.48538532]
     [ 0.43507599  0.52023238 -0.73489261  8.31416505]
     [ 0.          0.          0.          1.        ]]
    [[ 0.73816988  0.58662416  0.33313259  0.97616345]
     [-0.66467979  0.54800023  0.50783512 -1.58120044]
     [ 0.11535162 -0.59629509  0.79443449 -4.15975289]
     [ 0.          0.          0.          1.        ]] [[ 0.73816988  0.58662416  0.33313259  0.89426629]
     [ 0.66467979 -0.54800023 -0.50783512  2.624197  ]
     [-0.11535162  0.59629509 -0.79443449 12.84803042]
     [ 0.          0.          0.          1.        ]]
    [[ 0.54335993  0.37334457 -0.75191344 -3.11266394]
     [-0.30499619  0.92225799  0.23752375 -1.03808508]
     [ 0.78213638  0.10026985  0.6149867  -2.65567296]
     [ 0.          0.          0.          1.        ]] [[ 0.54335993  0.37334457 -0.75191344 -7.07395864]
     [ 0.30499619 -0.92225799 -0.23752375  1.79545652]
     [-0.78213638 -0.10026985 -0.6149867   9.82408695]
     [ 0.          0.          0.          1.        ]]
    [[ 0.72177108 -0.39627633  0.56746064  2.09485119]
     [ 0.66123716  0.637019   -0.39619719  2.47047114]
     [-0.20447964  0.66118973  0.72181453 -0.85803498]
     [ 0.          0.          0.          1.        ]] [[ 0.72177108 -0.39627633  0.56746064  0.71734437]
     [-0.66123716 -0.637019    0.39619719 -0.22584618]
     [ 0.20447964 -0.66118973 -0.72181453  7.5676814 ]
     [ 0.          0.          0.          1.        ]]
    [[ 0.82778203 -0.01664607 -0.56080284  4.28373726]
     [-0.39693066  0.6890482  -0.6063486  -2.23659211]
     [ 0.39651351  0.72452431  0.56377438  3.599554  ]
     [ 0.          0.          0.          1.        ]] [[ 0.82778203 -0.01664607 -0.56080284  0.40055411]
     [ 0.39693066 -0.6890482   0.6063486   6.06883871]
     [-0.39651351 -0.72452431 -0.56377438  2.87068387]
     [ 0.          0.          0.          1.        ]]



```python
# Formulating least squares from dataset
lhs = []
rhs = []
for i in range(numsamples):
    lhs.append(
        np.hstack([np.kron(gtAs[i][:3, :3], np.eye(4)), np.kron(-np.eye(3), gtBs[i].T)])
    )
    rhs.append(
        np.kron(gtAs[i][:3, -1], [0, 0, 0, -1])
    )
    
lhs = np.vstack(lhs)
rhs = np.hstack(rhs)
```


```python
solution, loss, iterations, eigenvalues = np.linalg.lstsq(lhs, rhs, rcond=None)

x = np.eye(4)
x[:3, :] = solution[:12].reshape(3, 4)
z = np.eye(4)
z[:3, :] = solution[12:].reshape(3, 4)

print("SOLUTION:")
print(x)
print(z)

print("GT:")
print(gtX)
print(gtZ)
```

    SOLUTION:
    [[ 1.00023409  0.00033743  0.00000271  1.00128298]
     [-0.00075093  1.00004801  0.00079284  2.00391593]
     [-0.00004894 -0.00078357  1.00045483  2.99555519]
     [ 0.          0.          0.          1.        ]]
    [[ 0.99961512 -0.00060328 -0.00038064  3.00466436]
     [-0.00103907 -1.00011341 -0.00062937  3.00385315]
     [-0.00070083  0.00124314 -1.0010084  10.00075089]
     [ 0.          0.          0.          1.        ]]
    GT:
    [[1. 0. 0. 1.]
     [0. 1. 0. 2.]
     [0. 0. 1. 3.]
     [0. 0. 0. 1.]]
    [[ 1. -0. -0.  3.]
     [ 0. -1. -0.  3.]
     [ 0. -0. -1. 10.]
     [ 0.  0.  0.  1.]]



```python
display(np.linalg.det(x))
display(np.linalg.det(z))

```


$\displaystyle 1.0007379463785$



$\displaystyle 1.0007382909633$

